name: Keep Backend Alive on Render

on:
  schedule:
    # Run every 10 minutes to prevent Render cold starts
    - cron: '*/10 * * * *'
  
  workflow_dispatch: # Allow manual trigger

jobs:
  ping-backend:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“ Ping Backend Health Endpoint
        run: |
          echo "Pinging backend at $(date)"
          
          # Backend URL - uses secret if set, otherwise uses your Render URL
          BACKEND_URL="${{ secrets.BACKEND_URL || 'https://la-patisserie-1.onrender.com' }}"
          
          # Ping with timeout and retry
          for i in 1 2 3; do
            if curl -f -m 15 "$BACKEND_URL/api/health"; then
              echo "âœ… Backend is alive (attempt $i)"
              exit 0
            else
              echo "âš ï¸ Ping attempt $i failed, retrying..."
              sleep 5
            fi
          done
          
          echo "âŒ All ping attempts failed"
          exit 1
      
      - name: ğŸ“Š Log Response Time
        if: success()
        run: |
          echo "Backend responded successfully at $(date)"
          echo "Next ping in 10 minutes"
